"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var React=_interopDefault(require("react")),antd=require("antd");function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(r,!0).forEach(function(t){_defineProperty(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _iterableToArrayLimit(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}var Option=antd.Select.Option,TextArea=antd.Input.TextArea,Search=antd.Input.Search,RangePicker=antd.DatePicker.RangePicker,RadioGroup=antd.Radio.Group,FormItems=function(e){function t(){var e,r;_classCallCheck(this,t);for(var n=arguments.length,o=new Array(n),a=0;a<n;a++)o[a]=arguments[a];return _defineProperty(_assertThisInitialized(r=_possibleConstructorReturn(this,(e=_getPrototypeOf(t)).call.apply(e,[this].concat(o)))),"getItem",function(e){switch(e.type){case"dateTime":return React.createElement(antd.DatePicker,{showTime:!0,style:{width:"100%"},disabledDate:e.disabledDate,disabledTime:e.disabledTime});case"dateRange":return React.createElement(RangePicker,{showTime:{format:"HH:mm"},format:"YYYY-MM-DD HH:mm",placeholder:e.placeholder||["Start Time","End Time"],onChange:e.onChange,onOk:e.onOk,allowClear:e.allowClear});case"radio":return React.createElement(RadioGroup,{disabled:e.disabled},e.radio.map(function(e){return React.createElement(antd.Radio,{value:e.value,key:e.value},e.text)}));case"select":return React.createElement(antd.Select,{placeholder:e.placeholder,disabled:e.disabled,onChange:e.onChange,showSearch:e.showSearch,optionFilterProp:e.optionFilterProp,filterOption:e.filterOption,allowClear:e.allowClear,mode:e.mode,maxTagCount:e.maxTagCount,className:e.className},e.options.map(function(e){return e.text||(e.text=e.value),React.createElement(Option,{value:e.value,key:e.value},e.text)}));case"textArea":return React.createElement(TextArea,{autoSize:{minRows:e.size},maxLength:e.maxLength,disabled:e.disabled,onBlur:e.onBlur});case"number":return React.createElement(antd.InputNumber,{min:e.min,max:e.max,step:e.step,onChange:e.onChange,placeholder:e.placeholder,disabled:e.disabled,className:e.className});case"btn":return React.createElement(antd.Button,{type:e.btnType||"primary",loading:e.loading,onClick:e.onClick,disabled:e.disabled},e.text);case"search":return React.createElement(Search,{placeholder:e.placeholder,enterButton:e.enterButtonText,size:e.size||"large",onSearch:e.onSearch});case"check":return React.createElement(antd.Checkbox.Group,{onChange:e.onChange},e.box.map(function(e,t){return React.createElement(antd.Checkbox,{value:e.value,key:t},e.text)}));case"component":return e.component;default:return React.createElement(antd.Input,{placeholder:e.placeholder,maxLength:e.maxLength,type:e.inputType,disabled:e.disabled,onBlur:e.onBlur})}}),_defineProperty(_assertThisInitialized(r),"getForm",function(e){if(r.props.form){var t=r.props.form.getFieldDecorator;return e.map(function(e,n){var o=e.label,a=e.key,i=e.required,c=e.extra,l=e.initialValue,s=e.rules,u=void 0===s?[]:s,d=e.slot,p=e.isShowSlot,h=e.toggler,m=void 0===h||h;return i&&(u=[].concat(_toConsumableArray(u),[{required:!0,message:"please add the ".concat(o||"value",".")}])),React.createElement("span",{className:"item-wrapper",key:n},m?React.createElement(antd.Form.Item,{label:o,key:n,extra:c,className:e.className},p?d:null,a?t(a,{initialValue:l,rules:u})(r.getItem(e)):r.getItem(e)):null)})}}),r}return _inherits(t,React.PureComponent),_createClass(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.needInit,r=e.data,n=e.form;t&&Object.keys(r).forEach(function(e){return setTimeout(function(){return n.setFieldsValue(_defineProperty({},e,r[e]))},0)})}},{key:"render",value:function(){return React.createElement("div",{className:"form-wrapper"},this.getForm(this.props.formItems))}}]),t}(),Schema=function e(t){_classCallCheck(this,e),this.schema=t,this.appendFather(t),this.origin=this.getObj(t)};Schema.prototype.appendFather=function(e){!function e(t){t.children&&t.children.map(function(r){r.father=t,r.children&&e(r)})}(e)},Schema.prototype.deepClone=function(e,t){var r=function(e){return"object"===_typeof(e)&&null!=e};if(!r(e))return e;t||(t=[]);var n=Array.isArray(e)?[]:{},o=function(e,t){for(var r=0;r<e.length;r++)if(e[r].source===t)return e[r];return null}(t,e);if(o)return o.target;for(var a in t.push({source:e,target:n}),e)Object.prototype.hasOwnProperty.call(e,a)&&(r(e[a])?n[a]=this.deepClone(e[a],t):n[a]=e[a]);return n},Schema.prototype.removeFather=function(e){!function e(t){t.children&&t.children.map(function(t){t.father=null,t.options&&(t.options=[{value:"1"}]),t.children&&e(t)})}(e)},Schema.prototype.getObj=function(e){var t=void 0===e.type?{}:"arr"===e.type?[]:{};if(void 0===e.key){if(e.children)for(var r in e.children)t[e.children[r].key]=this.getObj(e.children[r])}else if(e.children)for(var n in e.children)void 0===e.children[n].children?t[e.children[n].key]=e.children[n].value:t[e.children[n].key]=this.getObj(e.children[n]);return t},Schema.prototype.handleChildren=function(e){!function e(t){if(t.children){var r=_toConsumableArray(t.children);delete t.children;var n=[];r.map(function(e){n.push({type:e.type,key:e.key,value:"multiple"===e.mode?"politics":"",options:e.options,box:e.box,radios:e.radios,label:e.label,mode:e.mode,father:t,children:e.children,repeatable:e.repeatable,removable:e.removable})}),n.map(function(t){t.children&&e(t)}),t.children=n}}(e)},Schema.prototype.add=function(e){var t=_objectSpread2({},e);e.curKey||(e.curKey=e.key),e.curKey++,t.key=e.curKey,t.removable=!0,delete t.repeatable,t.curKey&&delete t.curKey,this.handleChildren(t),e.father.children.push(t),this.origin=this.getObj(this.schema)},Schema.prototype.remove=function(e){var t=_objectSpread2({},e);t.father.children=t.father.children.filter(function(e){return e.key!==t.key}),this.origin=this.getObj(this.schema)};var FormModel=function e(t){_classCallCheck(this,e),this.propertyName=t.propertyName||"Property Name",this.schemaInst=new Schema(t.schema),this.formModel=[],this.generateFormModel()};function styleInject(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var n=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===r&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}FormModel.prototype.getPropertySuffix=function(e){var t="";return function e(r){void 0!==r.father&&(void 0!==r.father.key?(t+="".concat(r.key,"-"),void 0!==r.father.father&&e(r.father)):t+="".concat(r.key))}(e),t},FormModel.prototype.generateFormModel=function(){var e=this;e.formModel=[],function t(r){r.children&&r.children.map(function(r){r.repeatable&&e.formModel.push({type:"btn",text:"+ Add",onClick:function(){return e.add(r)}}),r.removable&&e.formModel.push({type:"btn",text:"- Remove",onClick:function(){return e.remove(r)}}),"*"===r.keyName?e.formModel.push({label:e.propertyName,key:"prop_".concat(e.getPropertySuffix(r)),required:!0,initialValue:r.value,onBlur:function(t){r.value=t.target.value,e.schemaInst.origin=e.schemaInst.getObj(e.schemaInst.schema)}}):("arr"===r.type||"obj"===r.type&&"number"!=typeof r.key)&&e.formModel.push({type:"component",component:React.createElement("div",{style:{background:"#021e38",paddingLeft:"10px",borderRadius:"2px",color:"#fff",fontStyle:"italic"}},r.key)}),["str","number","select"].includes(r.type)&&e.formModel.push({type:r.type,label:r.label,options:r.options,key:"".concat(void 0===r.father.father.father.key?"":r.father.father.father.key,"[").concat(void 0===r.father.father.key?"":r.father.father.key,"][").concat(void 0===r.father.key?"":r.father.key,"][").concat(r.key,"]"),required:!0,initialValue:r.value,showSearch:r.showSearch||!0,optionFilterProp:r.optionFilterProp||"children",mode:r.mode,filterOption:function(e,t){return t.props.children&&0===t.props.children.toLowerCase().indexOf(e.toLowerCase())},allowClear:r.allowClear||!0,onChange:function(t){r.value=t,e.schemaInst.origin=e.schemaInst.getObj(e.schemaInst.schema)},onBlur:function(t){r.value=t.target.value,e.schemaInst.origin=e.schemaInst.getObj(e.schemaInst.schema)}}),r.children&&t(r)})}(e.schemaInst.schema)},FormModel.prototype.add=function(e){this.schemaInst.add(e),this.generateFormModel()},FormModel.prototype.remove=function(e){this.schemaInst.remove(e),this.generateFormModel()};var css=".json-editor-wrapper{display:flex;width:100%;justify-content:space-between}.json-editor-wrapper .form{width:40%}.json-editor-wrapper .form .ant-input-number{width:100%}.json-editor-wrapper pre{width:50%;border-radius:4px;padding:10px;margin-bottom:20px;background:#021e38;color:#fff}\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmNzcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxxQkFDSSxZQUFhLENBQ2IsVUFBVyxDQUNYLDZCQUNGLENBQ0EsMkJBQ0UsU0FDRixDQUNBLDZDQUNFLFVBQ0YsQ0FDQSx5QkFDRSxTQUFVLENBQ1YsaUJBQWtCLENBQ2xCLFlBQWEsQ0FDYixrQkFBbUIsQ0FDbkIsa0JBQW1CLENBQ25CLFVBQ0YiLCJmaWxlIjoiaW5kZXguY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmpzb24tZWRpdG9yLXdyYXBwZXJ7XG4gICAgZGlzcGxheTogZmxleDtcbiAgICB3aWR0aDogMTAwJTtcbiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47XG4gIH1cbiAgLmpzb24tZWRpdG9yLXdyYXBwZXIgLmZvcm0ge1xuICAgIHdpZHRoOiA0MCU7XG4gIH1cbiAgLmpzb24tZWRpdG9yLXdyYXBwZXIgLmZvcm0gLmFudC1pbnB1dC1udW1iZXIge1xuICAgIHdpZHRoOiAxMDAlO1xuICB9XG4gIC5qc29uLWVkaXRvci13cmFwcGVyIHByZSB7XG4gICAgd2lkdGg6IDUwJTtcbiAgICBib3JkZXItcmFkaXVzOiA0cHg7XG4gICAgcGFkZGluZzogMTBweDtcbiAgICBtYXJnaW4tYm90dG9tOiAyMHB4O1xuICAgIGJhY2tncm91bmQ6ICMwMjFlMzg7XG4gICAgY29sb3I6ICNmZmZcbiAgfSJdfQ== */";styleInject(css);var JSONEdit=function e(t){_classCallCheck(this,e),this.FormModelInst=new FormModel(t),this.isShowPreview=t.isShowPreview,this.generateCallback=t.generateCallback,this.schema=t.schema,this.newSchema={}};JSONEdit.prototype.init=function(){var e=this;return antd.Form.create({name:"Editor"})(function(t){var r=React.useState,n=React.useEffect,o=_slicedToArray(r({}),2),a=o[0],i=o[1];return n(function(){Object.keys(a).length&&e.generateCallback(a)},[a]),React.createElement("div",{className:"json-editor-wrapper",onClick:function(){t.form.validateFieldsAndScroll(function(e,t){})}},React.createElement(antd.Form,{className:"form"},React.createElement(FormItems,{formItems:e.FormModelInst.formModel,form:t.form}),React.createElement(antd.Button,{onClick:function(){(0,t.form.validateFieldsAndScroll)(function(e,t){if(!e){var r=Object.keys(t).filter(function(e){return e.startsWith("prop")}).reverse();r.length?i(function(e,t){i({});var r=JSON.parse(JSON.stringify(t));return e.map(function(e){var n=e.split("_")[1].split("-").reverse(),o=n.splice(0,1)[0],a=n.splice(-1,1)[0],i=n.join("][");if(i)try{r[o][i][t[e]]=r[o][i][a],delete r[o][i][a]}catch(e){console.log({e:e})}else void 0!==a?(r[o][t[e]]=r[o][a],delete r[o][a]):(r[t[e]]=r[o],delete r[o])}),e.map(function(e){return delete r[e]}),r}(r,t)):i(t)}})},type:"primary"},"Generate JSON")),e.isShowPreview?React.createElement("pre",null,React.createElement("code",null,JSON.stringify(a,null,2).replace("null,",""))):null)})},JSONEdit.prototype.removeFather=function(){return this.newSchema=this.FormModelInst.schemaInst.deepClone(this.schema),this.FormModelInst.schemaInst.removeFather(this.newSchema),this.newSchema},module.exports=JSONEdit;
